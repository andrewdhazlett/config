{"mode":"editor","version":1,"windowDimensions":{"x":0,"y":0,"width":2560,"height":1440},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/andrewhazlett/BTSync/dropoly/webapp","buffers":[{"text":"<template name='unsubscribe'>\n  {{email}} has been unsubscribed\n  <button class='btn btn-large btn-success undo'>Undo</button>\n</template>\n","markers":{"markers":{"2":{"id":2,"range":[[2,0],[3,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"overlap","persistent":true,"properties":{},"deserializer":"Marker"},"3":{"id":3,"range":[[2,0],[3,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"overlap","persistent":true,"properties":{},"deserializer":"Marker"},"4":{"id":4,"range":[[2,11],[2,11]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":2855,"goalBufferRange":null,"preserveFolds":true},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[1,33],[1,33]],"newRange":[[1,33],[2,0]],"oldText":"","newText":"\n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,0],[2,0]],"newRange":[[2,0],[2,2]],"oldText":"","newText":"  ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,2],[2,2]],"newRange":[[2,2],[2,3]],"oldText":"","newText":"<","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,3],[2,3]],"newRange":[[2,3],[2,4]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,4],[2,4]],"newRange":[[2,4],[2,5]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,5],[2,5]],"newRange":[[2,5],[2,6]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,6],[2,6]],"newRange":[[2,6],[2,7]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,7],[2,7]],"newRange":[[2,7],[2,8]],"oldText":"","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,8],[2,8]],"newRange":[[2,8],[2,9]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,9],[2,9]],"newRange":[[2,9],[2,10]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,10],[2,10]],"newRange":[[2,10],[2,11]],"oldText":"","newText":"c","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,11],[2,11]],"newRange":[[2,11],[2,12]],"oldText":"","newText":"l","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,12],[2,12]],"newRange":[[2,12],[2,13]],"oldText":"","newText":"a","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,13],[2,13]],"newRange":[[2,13],[2,14]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,14],[2,14]],"newRange":[[2,14],[2,15]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,15],[2,15]],"newRange":[[2,15],[2,16]],"oldText":"","newText":"=","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,16],[2,16]],"newRange":[[2,16],[2,18]],"oldText":"","newText":"''","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,17],[2,17]],"newRange":[[2,17],[2,18]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,18],[2,18]],"newRange":[[2,18],[2,19]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,19],[2,19]],"newRange":[[2,19],[2,20]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,20],[2,20]],"newRange":[[2,20],[2,21]],"oldText":"","newText":"-","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[2,21],[2,21]]},"newParams":{"reversed":true,"range":[[2,20],[2,21]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,20],[2,21]],"newRange":[[2,20],[2,20]],"oldText":"-","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,20],[2,20]],"newRange":[[2,20],[2,21]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,21],[2,21]],"newRange":[[2,21],[2,22]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,22],[2,22]],"newRange":[[2,22],[2,23]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,23],[2,23]],"newRange":[[2,23],[2,24]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,24],[2,24]],"newRange":[[2,24],[2,25]],"oldText":"","newText":"-","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,25],[2,25]],"newRange":[[2,25],[2,26]],"oldText":"","newText":"l","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,26],[2,26]],"newRange":[[2,26],[2,27]],"oldText":"","newText":"a","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,27],[2,27]],"newRange":[[2,27],[2,28]],"oldText":"","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,28],[2,28]],"newRange":[[2,28],[2,29]],"oldText":"","newText":"g","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,29],[2,29]],"newRange":[[2,29],[2,30]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,30],[2,30]],"newRange":[[2,30],[2,31]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,31],[2,31]],"newRange":[[2,31],[2,32]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,32],[2,32]],"newRange":[[2,32],[2,33]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,33],[2,33]],"newRange":[[2,33],[2,34]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,34],[2,34]],"newRange":[[2,34],[2,35]],"oldText":"","newText":"-","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,35],[2,35]],"newRange":[[2,35],[2,36]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,36],[2,36]],"newRange":[[2,36],[2,37]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,37],[2,37]],"newRange":[[2,37],[2,38]],"oldText":"","newText":"c","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,38],[2,38]],"newRange":[[2,38],[2,39]],"oldText":"","newText":"c","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,39],[2,39]],"newRange":[[2,39],[2,40]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,40],[2,40]],"newRange":[[2,40],[2,41]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,41],[2,41]],"newRange":[[2,41],[2,42]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,43],[2,43]],"newRange":[[2,43],[2,44]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,44],[2,44]],"newRange":[[2,44],[2,45]],"oldText":"","newText":"i","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"oldRange":[[2,44],[2,45]],"newRange":[[2,44],[2,44]],"oldText":"i","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"patches":[{"oldRange":[[2,44],[2,44]],"newRange":[[2,44],[2,46]],"oldText":"","newText":"id","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,46],[2,46]],"newRange":[[2,46],[2,47]],"oldText":"","newText":"=","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,47],[2,47]],"newRange":[[2,47],[2,49]],"oldText":"","newText":"''","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,48],[2,48]],"newRange":[[2,48],[2,49]],"oldText":"","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,49],[2,49]],"newRange":[[2,49],[2,50]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,50],[2,50]],"newRange":[[2,50],[2,51]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,51],[2,51]],"newRange":[[2,51],[2,52]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,52],[2,52]],"newRange":[[2,52],[2,53]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[2,53],[2,53]]},"newParams":{"reversed":true,"range":[[2,52],[2,53]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,52],[2,53]],"newRange":[[2,52],[2,52]],"oldText":"b","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[2,52],[2,52]]},"newParams":{"range":[[2,51],[2,52]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,51],[2,52]],"newRange":[[2,51],[2,51]],"oldText":"u","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[2,51],[2,51]]},"newParams":{"range":[[2,50],[2,51]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,50],[2,51]],"newRange":[[2,50],[2,50]],"oldText":"s","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[2,50],[2,50]]},"newParams":{"range":[[2,49],[2,50]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,49],[2,50]],"newRange":[[2,49],[2,49]],"oldText":"e","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[2,49],[2,49]]},"newParams":{"range":[[2,48],[2,49]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,48],[2,49]],"newRange":[[2,48],[2,48]],"oldText":"r","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,48],[2,48]],"newRange":[[2,48],[2,49]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,49],[2,49]],"newRange":[[2,49],[2,50]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,50],[2,50]],"newRange":[[2,50],[2,51]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[2,51],[2,51]]},"newParams":{"range":[[2,50],[2,51]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,50],[2,51]],"newRange":[[2,50],[2,50]],"oldText":"n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[2,50],[2,50]]},"newParams":{"range":[[2,49],[2,50]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,49],[2,50]],"newRange":[[2,49],[2,49]],"oldText":"b","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,49],[2,49]],"newRange":[[2,49],[2,50]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,50],[2,50]],"newRange":[[2,50],[2,51]],"oldText":"","newText":"d","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,51],[2,51]],"newRange":[[2,51],[2,52]],"oldText":"","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,53],[2,53]],"newRange":[[2,53],[2,54]],"oldText":"","newText":">","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,54],[2,54]],"newRange":[[2,54],[2,55]],"oldText":"","newText":"U","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,55],[2,55]],"newRange":[[2,55],[2,56]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,56],[2,56]],"newRange":[[2,56],[2,57]],"oldText":"","newText":"d","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,57],[2,57]],"newRange":[[2,57],[2,58]],"oldText":"","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,58],[2,58]],"newRange":[[2,58],[2,59]],"oldText":"","newText":"<","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,59],[2,59]],"newRange":[[2,59],[2,60]],"oldText":"","newText":"/","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,60],[2,60]],"newRange":[[2,60],[2,61]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,61],[2,61]],"newRange":[[2,61],[2,62]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,62],[2,62]],"newRange":[[2,62],[2,63]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,63],[2,63]],"newRange":[[2,63],[2,64]],"oldText":"","newText":"t","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,64],[2,64]],"newRange":[[2,64],[2,65]],"oldText":"","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,65],[2,65]],"newRange":[[2,65],[2,66]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,66],[2,66]],"newRange":[[2,66],[2,67]],"oldText":"","newText":".","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[2,67],[2,67]]},"newParams":{"range":[[2,66],[2,67]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,66],[2,67]],"newRange":[[2,66],[2,66]],"oldText":".","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,66],[2,66]],"newRange":[[2,66],[2,67]],"oldText":"","newText":">","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,42],[2,42]],"newRange":[[2,42],[2,43]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,43],[2,43]],"newRange":[[2,43],[2,44]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,44],[2,44]],"newRange":[[2,44],[2,45]],"oldText":"","newText":"n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,45],[2,45]],"newRange":[[2,45],[2,46]],"oldText":"","newText":"d","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,46],[2,46]],"newRange":[[2,46],[2,47]],"oldText":"","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,48],[2,58]],"newRange":[[2,48],[2,48]],"oldText":" id='undo'","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[3,0]],"newRange":[[2,0],[2,0]],"oldText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[2,0]],"newRange":[[2,0],[3,0]],"oldText":"","newText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[3,0]],"newRange":[[2,0],[2,0]],"oldText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[2,0]],"newRange":[[2,0],[3,0]],"oldText":"","newText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[3,0]],"newRange":[[2,0],[2,0]],"oldText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[2,0]],"newRange":[[2,0],[3,0]],"oldText":"","newText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[3,0]],"newRange":[[2,0],[2,0]],"oldText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[2,0]],"newRange":[[2,0],[3,0]],"oldText":"","newText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[3,0]],"newRange":[[2,0],[2,0]],"oldText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,0],[2,0]],"newRange":[[2,0],[3,0]],"oldText":"","newText":"  <button class='btn btn-large btn-success undo'>Undo</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/andrewhazlett/BTSync/dropoly/webapp/client/views/connect/unsubscribe.html","modifiedWhenLastPersisted":true,"digestWhenLastPersisted":"6ae8767d877415c2368eb29810fb1f680fc4e304","deserializer":"TextBuffer"},{"text":"### Email using the mandrill api ###\n\nUnsubscribers = new Meteor.Collection 'unsubscribers'\nUnsubscribers.attachSchema new SimpleSchema email: type: String\n\nMeteor.startup -> Meteor.Mandrill.config\n  username: 'dev@dropoly.com'\n  key: 'S_9dSN3t9KTLX-bOzAr40A'\n\nif Meteor.isServer then Meteor.methods\n  unsubscribe: (email) -> EmailService.unsubscribe email\n  resubscribe: (email) -> EmailService.resubscribe email\n\n# TODO - Maybe refactor to coffeescript class\n@EmailService =\n\n  fromAddress: 'join.us@dropoly.com'\n\n  sendReferralInviteEmail: (toEmail, referrerId, sponsorId) ->\n    baseUrl = Meteor.absoluteUrl 'referral', replaceLocalhost: true\n    url = baseUrl + '/' + referrerId + '/' + sponsorId\n    link = '<a href=\"' + url + '\">link</a>'\n    @sendTemplate\n      key: 'S_9dSN3t9KTLX-bOzAr40A'\n      templateSlug: 'referral-signup'\n      fromEmail: @fromAddress\n      templateContent: []\n      globalMergeVars: [\n        { name: 'usernameReferrer', content: Meteor.user().username },\n        { name: 'firstName', content: Meteor.user()?.profile?.firstName },\n        { name: 'lastName', content: Meteor.user()?.profile?.lastName },\n        { name: 'referralLink', content: url },\n        { name: 'nameSponsor', content: 'there'},\n        { name: 'unsubscribeUrl',\n        content: Meteor.absoluteUrl 'unsubscribe/' + toEmail },\n        { name: 'referralPoints', content: '+' + Points.referralConfirmation}]\n      toEmail: toEmail\n\n  sendNextCampaignEmail: (sponsorId) ->\n    # look up sponsor\n    sponsor = Sponsors.findOne sponsorId\n    # the next email index is the number of responses already logged\n    campaignResponses = _.filter sponsor.responses, (response) ->\n      /campaign*/.test response.templateSlug\n    # HAX HAX HAX\n    emailIndex = campaignResponses.length % EmailCampaign.length\n    campaignEmail = EmailCampaign[emailIndex] sponsor, Meteor.user().username\n    sponsorIsReferredByCurrentUser = sponsor?.referrerId is Meteor.user()._id\n    # && all the things!\n    allClearToSend =\n      sponsorIsReferredByCurrentUser and\n      sponsor.repliedToLastEmail and\n      Meteor.call 'setRepliedToLastEmail', sponsorId, Meteor.userId(), false\n    if allClearToSend then @sendTemplate campaignEmail\n    else console.log 'campaign email not sent',\n      'sponsorIsReferredByCurrentUser:', sponsorIsReferredByCurrentUser,\n      'sponsor.repliedToLastEmail:', sponsor.repliedToLastEmail\n\n  unsubscribe: (email) ->\n    unless !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.insert email: email)\n        console.log email, 'unsubscribed'\n      else console.log email, 'unsubscribe failed'\n    Unsubscribers.findOne email: email\n\n  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n  sendSMTPEmails: (emails, subject, html) ->\n    if emails instanceof String\n      # see if some genius tried joining the emails already\n      unless -1 is emails.indexOf ','\n        throw new Meteor.Error 400, 'send multiple emails in an array'\n      else if !!(Unsubscribers.findOne email: emails)\n        emails = undefined\n    else if emails instanceof Array\n      # filter out the unsubscribed emails and reduce\n      unsubscribedEmails = _.pluck Unsubscribers.find().fetch(), 'email'\n      emails = _.difference emails, unsubscribedEmails\n      emails = _.reduce emails, (memo, email) -> memo += email + ','\n    options = bcc: emails, from: @fromAddress, subject: subject, html: html\n    console.log 'sending to:' + emails\n    Meteor.Mandrill.send options\n\n  sendTemplate: (options) ->\n    unless !!(Unsubscribers.findOne email: options.toEmail)\n      Meteor.Mandrill.sendTemplate options\n    else console.log 'sorry, theyve unsubscribed'\n","markers":{"markers":{"1":{"id":1,"range":[[10,56],[10,56]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":2863,"goalBufferRange":null},"deserializer":"Marker"},"3":{"id":3,"range":[[9,0],[13,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"overlap","persistent":true,"properties":{},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[10,56],[10,56]],"newRange":[[10,56],[11,0]],"oldText":"","newText":"\n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[11,0],[11,0]],"newRange":[[11,0],[11,2]],"oldText":"","newText":"  ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,2],[11,2]],"newRange":[[11,2],[11,3]],"oldText":"","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,3],[11,3]],"newRange":[[11,3],[11,4]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,4],[11,4]],"newRange":[[11,4],[11,5]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,5],[11,5]],"newRange":[[11,5],[11,6]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,6],[11,6]],"newRange":[[11,6],[11,7]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,7],[11,7]],"newRange":[[11,7],[11,8]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,8],[11,8]],"newRange":[[11,8],[11,9]],"oldText":"","newText":"c","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,9],[11,9]],"newRange":[[11,9],[11,10]],"oldText":"","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,10],[11,10]],"newRange":[[11,10],[11,11]],"oldText":"","newText":"i","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,11],[11,11]],"newRange":[[11,11],[11,12]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,12],[11,12]],"newRange":[[11,12],[11,13]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,13],[11,13]],"newRange":[[11,13],[11,14]],"oldText":"","newText":":","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,14],[11,14]],"newRange":[[11,14],[11,15]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,15],[11,15]],"newRange":[[11,15],[11,17]],"oldText":"","newText":"()","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,16],[11,16]],"newRange":[[11,16],[11,17]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,17],[11,17]],"newRange":[[11,17],[11,18]],"oldText":"","newText":"m","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,18],[11,18]],"newRange":[[11,18],[11,19]],"oldText":"","newText":"a","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,19],[11,19]],"newRange":[[11,19],[11,20]],"oldText":"","newText":"i","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,20],[11,20]],"newRange":[[11,20],[11,21]],"oldText":"","newText":"l","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,21],[11,21]],"newRange":[[11,21],[11,22]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,22],[11,22]],"newRange":[[11,22],[11,23]],"oldText":"","newText":"-","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,23],[11,23]],"newRange":[[11,23],[11,24]],"oldText":"","newText":">","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[11,24],[11,24]]},"newParams":{"reversed":true,"range":[[11,23],[11,24]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,23],[11,24]],"newRange":[[11,23],[11,23]],"oldText":">","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[11,23],[11,23]]},"newParams":{"range":[[11,22],[11,23]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,22],[11,23]],"newRange":[[11,22],[11,22]],"oldText":"-","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[11,22],[11,22]]},"newParams":{"range":[[11,21],[11,22]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,21],[11,22]],"newRange":[[11,21],[11,21]],"oldText":" ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,22],[11,22]],"newRange":[[11,22],[11,23]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,23],[11,23]],"newRange":[[11,23],[11,24]],"oldText":"","newText":"-","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,24],[11,24]],"newRange":[[11,24],[11,25]],"oldText":"","newText":">","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,25],[11,25]],"newRange":[[11,25],[11,26]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,26],[11,26]],"newRange":[[11,26],[11,27]],"oldText":"","newText":"E","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,27],[11,27]],"newRange":[[11,27],[11,28]],"oldText":"","newText":"m","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"oldRange":[[11,26],[11,28]],"newRange":[[11,26],[11,26]],"oldText":"Em","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"patches":[{"oldRange":[[11,26],[11,26]],"newRange":[[11,26],[11,31]],"oldText":"","newText":"Email","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,31],[11,31]],"newRange":[[11,31],[11,32]],"oldText":"","newText":"S","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"oldRange":[[11,26],[11,32]],"newRange":[[11,26],[11,26]],"oldText":"EmailS","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"patches":[{"oldRange":[[11,26],[11,26]],"newRange":[[11,26],[11,32]],"oldText":"","newText":"emails","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,32],[11,32]],"newRange":[[11,32],[11,33]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"oldRange":[[11,26],[11,33]],"newRange":[[11,26],[11,26]],"oldText":"emailse","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"patches":[{"oldRange":[[11,26],[11,26]],"newRange":[[11,26],[11,38]],"oldText":"","newText":"EmailService","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,38],[11,38]],"newRange":[[11,38],[11,39]],"oldText":"","newText":".","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,39],[11,39]],"newRange":[[11,39],[11,40]],"oldText":"","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,40],[11,40]],"newRange":[[11,40],[11,41]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[11,41],[11,41]]},"newParams":{"reversed":true,"range":[[11,40],[11,41]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,40],[11,41]],"newRange":[[11,40],[11,40]],"oldText":"s","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,40],[11,40]],"newRange":[[11,40],[11,41]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,41],[11,41]],"newRange":[[11,41],[11,42]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,42],[11,42]],"newRange":[[11,42],[11,43]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"oldRange":[[11,39],[11,43]],"newRange":[[11,39],[11,39]],"oldText":"resu","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"patches":[{"oldRange":[[11,39],[11,39]],"newRange":[[11,39],[11,50]],"oldText":"","newText":"resubscribe","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,50],[11,50]],"newRange":[[11,50],[11,51]],"oldText":"","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,51],[11,51]],"newRange":[[11,51],[11,52]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,52],[11,52]],"newRange":[[11,52],[11,53]],"oldText":"","newText":"a","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,53],[11,53]],"newRange":[[11,53],[11,54]],"oldText":"","newText":"m","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,54],[11,54]],"newRange":[[11,54],[11,55]],"oldText":"","newText":"i","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,55],[11,55]],"newRange":[[11,55],[11,56]],"oldText":"","newText":"l","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[11,56],[11,56]]},"newParams":{"reversed":true,"range":[[11,55],[11,56]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,55],[11,56]],"newRange":[[11,55],[11,55]],"oldText":"l","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[11,55],[11,55]]},"newParams":{"range":[[11,54],[11,55]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,54],[11,55]],"newRange":[[11,54],[11,54]],"oldText":"i","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[11,54],[11,54]]},"newParams":{"range":[[11,53],[11,54]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,53],[11,54]],"newRange":[[11,53],[11,53]],"oldText":"m","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[11,53],[11,53]]},"newParams":{"range":[[11,52],[11,53]]},"deserializer":"MarkerPatch"},{"oldRange":[[11,52],[11,53]],"newRange":[[11,52],[11,52]],"oldText":"a","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,52],[11,52]],"newRange":[[11,52],[11,53]],"oldText":"","newText":"m","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"oldRange":[[11,51],[11,53]],"newRange":[[11,51],[11,51]],"oldText":"em","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"patches":[{"oldRange":[[11,51],[11,51]],"newRange":[[11,51],[11,56]],"oldText":"","newText":"email","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[57,0],[63,38]]},"newParams":{"tailed":false,"range":[[63,38],[63,38]]},"deserializer":"MarkerPatch"},{"oldRange":[[57,0],[63,38]],"newRange":[[57,0],[63,42]],"oldText":"\n  unsubscribe: (email) ->\n    unless !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.insert email: email)\n        console.log email, 'unsubscribed'\n      else console.log email, 'unsubscribe failed'\n    Unsubscribers.findOne email: email","newText":"\n      unsubscribe: (email) ->\n        unless !!(Unsubscribers.findOne email: email)\n          if !!(Unsubscribers.insert email: email)\n            console.log email, 'unsubscribed'\n          else console.log email, 'unsubscribe failed'\n        Unsubscribers.findOne email: email","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[63,42],[63,42]],"newRange":[[63,42],[69,46]],"oldText":"","newText":"\n          unsubscribe: (email) ->\n            unless !!(Unsubscribers.findOne email: email)\n              if !!(Unsubscribers.insert email: email)\n                console.log email, 'unsubscribed'\n              else console.log email, 'unsubscribe failed'\n            Unsubscribers.findOne email: email","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[58,0],[58,2]],"newRange":[[58,0],[58,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[59,0],[59,2]],"newRange":[[59,0],[59,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[60,0],[60,2]],"newRange":[[60,0],[60,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[61,0],[61,2]],"newRange":[[61,0],[61,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[62,0],[62,2]],"newRange":[[62,0],[62,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[63,0],[63,2]],"newRange":[[63,0],[63,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[64,2]],"newRange":[[64,0],[64,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[65,0],[65,2]],"newRange":[[65,0],[65,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[66,0],[66,2]],"newRange":[[66,0],[66,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[67,0],[67,2]],"newRange":[[67,0],[67,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[68,0],[68,2]],"newRange":[[68,0],[68,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[69,0],[69,2]],"newRange":[[69,0],[69,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[58,0],[58,2]],"newRange":[[58,0],[58,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[59,0],[59,2]],"newRange":[[59,0],[59,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[60,0],[60,2]],"newRange":[[60,0],[60,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[61,0],[61,2]],"newRange":[[61,0],[61,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[62,0],[62,2]],"newRange":[[62,0],[62,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[63,0],[63,2]],"newRange":[[63,0],[63,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[64,2]],"newRange":[[64,0],[64,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[65,0],[65,2]],"newRange":[[65,0],[65,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[66,0],[66,2]],"newRange":[[66,0],[66,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[67,0],[67,2]],"newRange":[[67,0],[67,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[68,0],[68,2]],"newRange":[[68,0],[68,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[69,0],[69,2]],"newRange":[[69,0],[69,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[64,0],[64,2]],"newRange":[[64,0],[64,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[65,0],[65,2]],"newRange":[[65,0],[65,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[66,0],[66,2]],"newRange":[[66,0],[66,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[67,0],[67,2]],"newRange":[[67,0],[67,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[68,0],[68,2]],"newRange":[[68,0],[68,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[69,0],[69,2]],"newRange":[[69,0],[69,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[64,0],[64,2]],"newRange":[[64,0],[64,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[65,0],[65,2]],"newRange":[[65,0],[65,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[66,0],[66,2]],"newRange":[[66,0],[66,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[67,0],[67,2]],"newRange":[[67,0],[67,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[68,0],[68,2]],"newRange":[[68,0],[68,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[69,0],[69,2]],"newRange":[[69,0],[69,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[63,38],[63,38]],"newRange":[[63,38],[64,0]],"oldText":"","newText":"\n","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[64,0]],"newRange":[[64,0],[64,4]],"oldText":"","newText":"    ","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[65,2],[65,13]]},"newParams":{"tailed":false,"range":[[65,13],[65,13]]},"deserializer":"MarkerPatch"},{"oldRange":[[65,2],[65,13]],"newRange":[[65,2],[65,3]],"oldText":"unsubscribe","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[65,3],[65,3]],"newRange":[[65,3],[65,4]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[65,4],[65,4]],"newRange":[[65,4],[65,5]],"oldText":"","newText":"s","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[65,5],[65,5]],"newRange":[[65,5],[65,6]],"oldText":"","newText":"u","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[65,6],[65,6]],"newRange":[[65,6],[65,7]],"oldText":"","newText":"b","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"oldRange":[[65,2],[65,7]],"newRange":[[65,2],[65,2]],"oldText":"resub","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"patches":[{"oldRange":[[65,2],[65,2]],"newRange":[[65,2],[65,13]],"oldText":"","newText":"resubscribe","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[66,4],[66,10]]},"newParams":{"tailed":false,"range":[[66,10],[66,10]]},"deserializer":"MarkerPatch"},{"oldRange":[[66,4],[66,10]],"newRange":[[66,4],[66,5]],"oldText":"unless","newText":"i","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[66,5],[66,5]],"newRange":[[66,5],[66,6]],"oldText":"","newText":"f","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[67,26],[67,32]]},"newParams":{"tailed":false,"range":[[67,32],[67,32]]},"deserializer":"MarkerPatch"},{"oldRange":[[67,26],[67,32]],"newRange":[[67,26],[67,27]],"oldText":"insert","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[67,27],[67,27]],"newRange":[[67,27],[67,28]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[67,28],[67,28]],"newRange":[[67,28],[67,29]],"oldText":"","newText":"m","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[67,29],[67,29]],"newRange":[[67,29],[67,30]],"oldText":"","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[67,30],[67,30]],"newRange":[[67,30],[67,31]],"oldText":"","newText":"v","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[67,31],[67,31]],"newRange":[[67,31],[67,32]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[68,28],[68,30]]},"newParams":{"tailed":false,"range":[[68,28],[68,28]]},"deserializer":"MarkerPatch"},{"oldRange":[[68,28],[68,30]],"newRange":[[68,28],[68,29]],"oldText":"un","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"range":[[68,28],[68,28]]},"newParams":{"range":[[68,29],[68,29]]},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[68,29],[68,29]],"newRange":[[68,29],[68,30]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[69,31],[69,33]]},"newParams":{"tailed":false,"range":[[69,31],[69,31]]},"deserializer":"MarkerPatch"},{"oldRange":[[69,31],[69,33]],"newRange":[[69,31],[69,32]],"oldText":"un","newText":"r","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"range":[[69,31],[69,31]]},"newParams":{"range":[[69,32],[69,32]]},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[69,32],[69,32]],"newRange":[[69,32],[69,33]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[70,4],[70,4]],"newRange":[[70,4],[70,5]],"oldText":"","newText":"!","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[70,5],[70,5]],"newRange":[[70,5],[70,6]],"oldText":"","newText":"(","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[70,40],[70,40]],"newRange":[[70,40],[70,41]],"oldText":"","newText":")","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[70,41],[70,41]],"newRange":[[70,41],[70,42]],"oldText":"","newText":"?","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[64,0],[64,4]],"newRange":[[64,0],[64,0]],"oldText":"    ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[12,0]],"newRange":[[11,0],[11,0]],"oldText":"  resubscribe: (email) -> EmailService.resubscribe email\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[71,0]],"newRange":[[64,0],[64,0]],"oldText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[11,0]],"newRange":[[11,0],[12,0]],"oldText":"","newText":"  resubscribe: (email) -> EmailService.resubscribe email\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[65,0],[65,0]],"newRange":[[65,0],[72,0]],"oldText":"","newText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[12,0]],"newRange":[[11,0],[11,0]],"oldText":"  resubscribe: (email) -> EmailService.resubscribe email\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[71,0]],"newRange":[[64,0],[64,0]],"oldText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[9,0]],"oldText":"","newText":"Meteor.startup ->\n  Meteor.Mandrill.config\n    username: 'dev@dropoly.com'\n    key: 'S_9dSN3t9KTLX-bOzAr40A'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[9,0],[12,0]],"newRange":[[9,0],[9,0]],"oldText":"Meteor.startup -> Meteor.Mandrill.config\n  username: 'dev@dropoly.com'\n  key: 'S_9dSN3t9KTLX-bOzAr40A'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[10,0],[13,0]],"newRange":[[10,0],[10,0]],"oldText":"if Meteor.isServer then Meteor.methods\n  unsubscribe: (email) -> EmailService.unsubscribe email\n\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[13,0],[13,0]],"newRange":[[13,0],[14,0]],"oldText":"","newText":"  fromAddress: 'noreply@dropoly.com'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[14,0],[15,0]],"newRange":[[14,0],[14,0]],"oldText":"  fromAddress: 'join.us@dropoly.com'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[16,0],[16,0]],"newRange":[[16,0],[17,0]],"oldText":"","newText":"    username = (Meteor.users.findOne referrerId).username\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[23,0],[23,0]],"newRange":[[23,0],[24,0]],"oldText":"","newText":"      fromEmail: 'noreply@dropoly.com'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[24,0],[25,0]],"newRange":[[24,0],[24,0]],"oldText":"      fromEmail: 'join.us@dropoly.com'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[26,0],[26,0]],"newRange":[[26,0],[27,0]],"oldText":"","newText":"        { name: 'usernameReferrer', content: username },\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[27,0],[30,0]],"newRange":[[27,0],[27,0]],"oldText":"        { name: 'usernameReferrer', content: Meteor.user().username },\n        { name: 'firstName', content: Meteor.user()?.profile?.firstName },\n        { name: 'lastName', content: Meteor.user()?.profile?.lastName },\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[28,0],[28,0]],"newRange":[[28,0],[29,0]],"oldText":"","newText":"        { name: 'nameSponsor', content: 'there'} ]\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[29,0],[33,0]],"newRange":[[29,0],[29,0]],"oldText":"        { name: 'nameSponsor', content: 'there'},\n        { name: 'unsubscribeUrl',\n        content: Meteor.absoluteUrl 'unsubscribe/' + toEmail },\n        { name: 'referralPoints', content: '+' + Points.referralConfirmation}]\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[34,0],[40,0]],"newRange":[[34,0],[34,0]],"oldText":"    # the next email index is the number of responses already logged\n    campaignResponses = _.filter sponsor.responses, (response) ->\n      /campaign*/.test response.templateSlug\n    # HAX HAX HAX\n    emailIndex = campaignResponses.length % EmailCampaign.length\n    campaignEmail = EmailCampaign[emailIndex] sponsor, Meteor.user().username\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[35,0],[35,0]],"newRange":[[35,0],[40,0]],"oldText":"","newText":"    if sponsorIsReferredByCurrentUser\n      # TODO: determine which email to send\n      # Get an email campaign function and pass sponsor and username\n      # Pass the returned Mandrill template send object to Mandrill\n      @sendTemplate EmailCampaign[0] sponsor, Meteor.user().username\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[40,0],[49,0]],"newRange":[[40,0],[40,0]],"oldText":"    # && all the things!\n    allClearToSend =\n      sponsorIsReferredByCurrentUser and\n      sponsor.repliedToLastEmail and\n      Meteor.call 'setRepliedToLastEmail', sponsorId, Meteor.userId(), false\n    if allClearToSend then @sendTemplate campaignEmail\n    else console.log 'campaign email not sent',\n      'sponsorIsReferredByCurrentUser:', sponsorIsReferredByCurrentUser,\n      'sponsor.repliedToLastEmail:', sponsor.repliedToLastEmail\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[43,0],[43,0]],"newRange":[[43,0],[44,0]],"oldText":"","newText":"      Unsubscribers.insert email: email\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[44,0],[48,0]],"newRange":[[44,0],[44,0]],"oldText":"      if !!(Unsubscribers.insert email: email)\n        console.log email, 'unsubscribed'\n      else console.log email, 'unsubscribe failed'\n    Unsubscribers.findOne email: email\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[64,0]],"newRange":[[64,0],[83,0]],"oldText":"","newText":"\n# TODO - move this to a collection? _.extend a default email? both?\n@EmailCampaign = [\n  (sponsor, usernameReferrer) ->\n    key: 'S_9dSN3t9KTLX-bOzAr40A'\n    templateSlug: 'qa-lights-1'\n    globalMergeVars: [\n      { name: 'usernameReferrer',\n      content: usernameReferrer },\n      { name: 'nameSponsor',\n      content: 'there' },\n      { name: 'answer0Url',\n      content: Meteor.absoluteUrl 'sponsor/lights/' + sponsor._id + '/0' },\n      { name: 'answer1Url',\n      content: Meteor.absoluteUrl 'sponsor/lights/' + sponsor._id + '/1' },\n    ]\n    templateContent: []\n    toEmail: sponsor.email\n]\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[83,0],[84,0]],"newRange":[[83,0],[83,0]],"oldText":"    else console.log 'sorry, theyve unsubscribed'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[6,0]],"oldText":"","newText":"<<<<<<< Updated upstream\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[10,0],[10,0]],"newRange":[[10,0],[14,0]],"oldText":"","newText":"=======\nMeteor.startup -> Meteor.Mandrill.config\n  username: 'dev@dropoly.com'\n  key: 'S_9dSN3t9KTLX-bOzAr40A'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[15,0],[15,0]],"newRange":[[15,0],[20,0]],"oldText":"","newText":"if Meteor.isServer then Meteor.methods\n  unsubscribe: (email) -> EmailService.unsubscribe email\n  resubscribe: (email) -> EmailService.resubscribe email\n>>>>>>> Stashed changes\n\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[55,0],[55,0]],"newRange":[[55,0],[62,0]],"oldText":"","newText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[18,0],[18,23]],"newRange":[[18,0],[18,0]],"oldText":">>>>>>> Stashed changes","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[18,0],[18,0]]},"newParams":{"range":[[17,56],[18,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[17,56],[18,0]],"newRange":[[17,56],[17,56]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[10,7]],"newRange":[[5,0],[5,0]],"oldText":"<<<<<<< Updated upstream\nMeteor.startup ->\n  Meteor.Mandrill.config\n    username: 'dev@dropoly.com'\n    key: 'S_9dSN3t9KTLX-bOzAr40A'\n=======","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[5,0],[5,0]]},"newParams":{"range":[[4,0],[5,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[4,0],[5,0]],"newRange":[[4,0],[4,0]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[9,0]],"oldText":"","newText":"Meteor.startup ->\n  Meteor.Mandrill.config\n    username: 'dev@dropoly.com'\n    key: 'S_9dSN3t9KTLX-bOzAr40A'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[9,0],[12,0]],"newRange":[[9,0],[9,0]],"oldText":"Meteor.startup -> Meteor.Mandrill.config\n  username: 'dev@dropoly.com'\n  key: 'S_9dSN3t9KTLX-bOzAr40A'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[10,0],[14,0]],"newRange":[[10,0],[10,0]],"oldText":"if Meteor.isServer then Meteor.methods\n  unsubscribe: (email) -> EmailService.unsubscribe email\n  resubscribe: (email) -> EmailService.resubscribe email\n\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[45,0],[52,0]],"newRange":[[45,0],[45,0]],"oldText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[8,0]],"oldText":"","newText":"Meteor.startup -> Meteor.Mandrill.config\n  username: 'dev@dropoly.com'\n  key: 'S_9dSN3t9KTLX-bOzAr40A'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[8,0],[12,0]],"newRange":[[8,0],[8,0]],"oldText":"Meteor.startup ->\n  Meteor.Mandrill.config\n    username: 'dev@dropoly.com'\n    key: 'S_9dSN3t9KTLX-bOzAr40A'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[9,0],[9,0]],"newRange":[[9,0],[12,0]],"oldText":"","newText":"if Meteor.isServer then Meteor.methods\n  unsubscribe: (email) -> EmailService.unsubscribe email\n\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[18,0],[19,0]],"newRange":[[18,0],[18,0]],"oldText":"    username = (Meteor.users.findOne referrerId).username\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[27,0],[27,0]],"newRange":[[27,0],[30,0]],"oldText":"","newText":"        { name: 'usernameReferrer', content: Meteor.user().username },\n        { name: 'firstName', content: Meteor.user()?.profile?.firstName },\n        { name: 'lastName', content: Meteor.user()?.profile?.lastName },\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[30,0],[31,0]],"newRange":[[30,0],[30,0]],"oldText":"        { name: 'usernameReferrer', content: username },\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[31,0],[31,0]],"newRange":[[31,0],[35,0]],"oldText":"","newText":"        { name: 'nameSponsor', content: 'there'},\n        { name: 'unsubscribeUrl',\n        content: Meteor.absoluteUrl 'unsubscribe/' + toEmail },\n        { name: 'referralPoints', content: '+' + Points.referralConfirmation}]\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[35,0],[36,0]],"newRange":[[35,0],[35,0]],"oldText":"        { name: 'nameSponsor', content: 'there'} ]\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[40,0],[40,0]],"newRange":[[40,0],[46,0]],"oldText":"","newText":"    # the next email index is the number of responses already logged\n    campaignResponses = _.filter sponsor.responses, (response) ->\n      /campaign*/.test response.templateSlug\n    # HAX HAX HAX\n    emailIndex = campaignResponses.length % EmailCampaign.length\n    campaignEmail = EmailCampaign[emailIndex] sponsor, Meteor.user().username\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[47,0],[47,0]],"newRange":[[47,0],[56,0]],"oldText":"","newText":"    # && all the things!\n    allClearToSend =\n      sponsorIsReferredByCurrentUser and\n      sponsor.repliedToLastEmail and\n      Meteor.call 'setRepliedToLastEmail', sponsorId, Meteor.userId(), false\n    if allClearToSend then @sendTemplate campaignEmail\n    else console.log 'campaign email not sent',\n      'sponsorIsReferredByCurrentUser:', sponsorIsReferredByCurrentUser,\n      'sponsor.repliedToLastEmail:', sponsor.repliedToLastEmail\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[56,0],[61,0]],"newRange":[[56,0],[56,0]],"oldText":"    if sponsorIsReferredByCurrentUser\n      # TODO: determine which email to send\n      # Get an email campaign function and pass sponsor and username\n      # Pass the returned Mandrill template send object to Mandrill\n      @sendTemplate EmailCampaign[0] sponsor, Meteor.user().username\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[59,0],[59,0]],"newRange":[[59,0],[63,0]],"oldText":"","newText":"      if !!(Unsubscribers.insert email: email)\n        console.log email, 'unsubscribed'\n      else console.log email, 'unsubscribe failed'\n    Unsubscribers.findOne email: email\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[63,0],[64,0]],"newRange":[[63,0],[63,0]],"oldText":"      Unsubscribers.insert email: email\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[83,0],[83,0]],"newRange":[[83,0],[84,0]],"oldText":"","newText":"    else console.log 'sorry, theyve unsubscribed'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[84,0],[103,0]],"newRange":[[84,0],[84,0]],"oldText":"\n# TODO - move this to a collection? _.extend a default email? both?\n@EmailCampaign = [\n  (sponsor, usernameReferrer) ->\n    key: 'S_9dSN3t9KTLX-bOzAr40A'\n    templateSlug: 'qa-lights-1'\n    globalMergeVars: [\n      { name: 'usernameReferrer',\n      content: usernameReferrer },\n      { name: 'nameSponsor',\n      content: 'there' },\n      { name: 'answer0Url',\n      content: Meteor.absoluteUrl 'sponsor/lights/' + sponsor._id + '/0' },\n      { name: 'answer1Url',\n      content: Meteor.absoluteUrl 'sponsor/lights/' + sponsor._id + '/1' },\n    ]\n    templateContent: []\n    toEmail: sponsor.email\n]\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[11,0]],"newRange":[[11,0],[15,0]],"oldText":"","newText":"<<<<<<< Updated upstream\n=======\n  resubscribe: (email) -> EmailService.resubscribe email\n>>>>>>> Stashed changes\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[68,0],[68,0]],"newRange":[[68,0],[75,0]],"oldText":"","newText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[14,0],[14,23]],"newRange":[[14,0],[14,0]],"oldText":">>>>>>> Stashed changes","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[14,0],[14,0]]},"newParams":{"range":[[13,56],[14,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[13,56],[14,0]],"newRange":[[13,56],[13,56]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[12,7]],"newRange":[[11,0],[11,0]],"oldText":"<<<<<<< Updated upstream\n=======","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[11,0],[11,0]]},"newParams":{"range":[[10,56],[11,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[10,56],[11,0]],"newRange":[[10,56],[10,56]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[12,0]],"newRange":[[11,0],[11,0]],"oldText":"  resubscribe: (email) -> EmailService.resubscribe email\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[71,0]],"newRange":[[64,0],[64,0]],"oldText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[11,0]],"newRange":[[11,0],[12,0]],"oldText":"","newText":"  resubscribe: (email) -> EmailService.resubscribe email\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[16,0],[16,0]],"newRange":[[16,0],[17,0]],"oldText":"","newText":"  fromAddress: 'join.us@dropoly.com'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[17,0],[18,0]],"newRange":[[17,0],[17,0]],"oldText":"  fromAddress: 'noreply@dropoly.com'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[25,0],[25,0]],"newRange":[[25,0],[26,0]],"oldText":"","newText":"      fromEmail: @fromAddress\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[26,0],[27,0]],"newRange":[[26,0],[26,0]],"oldText":"      fromEmail: 'noreply@dropoly.com'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[65,0],[65,0]],"newRange":[[65,0],[72,0]],"oldText":"","newText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[12,0]],"newRange":[[11,0],[11,0]],"oldText":"  resubscribe: (email) -> EmailService.resubscribe email\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[15,0],[15,0]],"newRange":[[15,0],[16,0]],"oldText":"","newText":"  fromAddress: 'noreply@dropoly.com'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[16,0],[17,0]],"newRange":[[16,0],[16,0]],"oldText":"  fromAddress: 'join.us@dropoly.com'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[24,0],[24,0]],"newRange":[[24,0],[25,0]],"oldText":"","newText":"      fromEmail: 'noreply@dropoly.com'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[25,0],[26,0]],"newRange":[[25,0],[25,0]],"oldText":"      fromEmail: @fromAddress\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[64,0],[71,0]],"newRange":[[64,0],[64,0]],"oldText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[11,0],[11,0]],"newRange":[[11,0],[12,0]],"oldText":"","newText":"  resubscribe: (email) -> EmailService.resubscribe email\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[16,0],[16,0]],"newRange":[[16,0],[17,0]],"oldText":"","newText":"  fromAddress: 'join.us@dropoly.com'\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[17,0],[18,0]],"newRange":[[17,0],[17,0]],"oldText":"  fromAddress: 'noreply@dropoly.com'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[25,0],[25,0]],"newRange":[[25,0],[26,0]],"oldText":"","newText":"      fromEmail: @fromAddress\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[26,0],[27,0]],"newRange":[[26,0],[26,0]],"oldText":"      fromEmail: 'noreply@dropoly.com'\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[65,0],[65,0]],"newRange":[[65,0],[72,0]],"oldText":"","newText":"  resubscribe: (email) ->\n    if !!(Unsubscribers.findOne email: email)\n      if !!(Unsubscribers.remove email: email)\n        console.log email, 'resubscribed'\n      else console.log email, 'resubscribe failed'\n    !(Unsubscribers.findOne email: email)?\n\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/andrewhazlett/BTSync/dropoly/webapp/server/email.coffee","modifiedWhenLastPersisted":true,"digestWhenLastPersisted":"0cf4eb9f97e66356f0f1f5e9823e0cd2eac73cbc","deserializer":"TextBuffer"},{"text":"@ResponseSchema = new SimpleSchema\n  templateSlug: type: String, max: 50\n  response: type: Number\n\n@SponsorSchema = new SimpleSchema\n  email: type: String, unique: true\n  referrerId: type: String, optional: true\n  confirmed: type: Boolean, defaultValue: false\n  points: type: Number, defaultValue: 0\n  repliedToLastEmail: type: Boolean, defaultValue: false\n  responses: type: [ResponseSchema], defaultValue: [] #optional: true\n\n@Sponsors = new Meteor.Collection 'sponsors'\n\nSponsors.attachSchema SponsorSchema\n\nif Meteor.isServer then Meteor.methods\n\n  setRepliedToLastEmail: (sponsorId, referrerId, value) ->\n    !!(Sponsors.update sponsorId, $set: repliedToLastEmail: value) and\n    !!(Meteor.users.update\n      _id: referrerId, 'secureProfile.sponsors.sponsorId': sponsorId,\n      { $set: 'secureProfile.sponsors.$.repliedToLastEmail': value })\n\n  createReferral: (email) ->\n    # a referral is a duplicate if the current user has sent a referral email\n    # or if there already exists a confirmed Sponsor record w/ that email;\n    # this allows multiple users to send referrals to a single email address\n    isDuplicateReferral = (Sponsors.findOne email: email)?.confirmed or\n      _.some Meteor.user().secureProfile.sponsors,\n        (sponsor) -> sponsor.email is email\n    # don't allow duplicate referrals\n    unless isDuplicateReferral\n      # insert a sponsor record if one doesn't exist\n      sponsorId = (Sponsors.findOne email: email)?._id or\n        Sponsors.insert { email: email, confirmed: false, points: 0 }\n      # denormalize the sponsor record\n      Meteor.users.update @userId, $push: 'secureProfile.sponsors':\n        email: email,\n        sponsorId: sponsorId,\n        confirmed: false,\n        repliedToLastEmail: false,\n        points: 0\n      EmailService.sendReferralInviteEmail email, @userId, sponsorId\n\n  resendReferral: (sponsor) ->\n    EmailService.sendReferralInviteEmail sponsor.email,\n    Meteor.userId(), sponsor.sponsorId\n\n  confirmReferral: (referrerId, sponsorId) ->\n    # a sponsor can only confirm one referral\n    unless (Sponsors.findOne sponsorId)?.confirmed\n      # confirm the referral\n      sponsorUpdated = Sponsors.update _id: sponsorId,\n        $set:\n          confirmed: true,\n          referrerId: referrerId,\n          repliedToLastEmail: true\n      # memoize for the referrer\n      sponsoreeUpdated = Meteor.users.update(\n        {_id: referrerId,\n        'secureProfile.sponsors.sponsorId': sponsorId},\n        { $set: 'secureProfile.sponsors.$.confirmed': true,\n        'secureProfile.sponsors.$.repliedToLastEmail': true})\n      # only earn points if both updates were successful\n      if sponsorUpdated and sponsoreeUpdated\n        PointsHub.earnSponsorPoints Points.referralConfirmation,\n          referrerId, sponsorId\n\n  sendPostLessonEmail: (lessonId) ->\n    console.log 'sending post-lesson emails'\n    emails = _.pluck (Sponsors.find referrerId: @userId).fetch(), 'email'\n    lesson = Lessons.findOne _id: lessonId\n    subject = 'I\\'ve completed an energy lesson!'\n    message = '<p>I\\'ve been using Dropoly to learn about energy, and I\\'ve ' +\n      'just finished the ' + lesson.title + '. Click the link below to help ' +\n      'me earn points and find out more!</p> <br> <a href=\\'' +\n      (Meteor.absoluteUrl 'lesson/' + lessonId) + '\\''\n    EmailService.sendSMTPEmails emails, subject, message\n\n  generateNextBlast: ->\n    sponsorsToSendTo = (Sponsors.find referrerId: Meteor.userId(),\n      repliedToLastEmail: true).fetch()\n    console.log sponsorsToSendTo\n    for sponsor in sponsorsToSendTo\n      console.log 'blast', sponsor\n      EmailService.sendNextCampaignEmail sponsor\n      Meteor.call 'resetRepliedToLastEmail', sponsor._id,\n        sponsor.referrerId, false\n\n  logSponsorEmailResponse: (sponsorId, templateSlug, response) ->\n    sponsor = Sponsors.findOne sponsorId\n    if sponsor?\n      # check for previous response\n      priorResponse = _.findWhere sponsor.responses,\n        templateSlug: templateSlug if sponsor.responses?\n      unless priorResponse?\n        # insert sponsor response\n        Sponsors.update sponsorId, $push: responses:\n          templateSlug: templateSlug, response: response\n        # update \"sponsor has replied to latest email\"\n        Meteor.call 'setRepliedToLastEmail', sponsorId, sponsor.referrerId, true\n        # earn points\n        PointsHub.earnSponsorPoints Points.sponsorEmailResponse,\n          sponsor.referrerId, sponsorId\n\n  generateNextSingleBlast: (sponsorId) ->\n    sponsor = Sponsors.findOne _id: sponsorId\n    # TODO: check memoized records against the defined schema\n    EmailService.sendNextCampaignEmail sponsor._id\n    # update \"sponsor has replied to latest email\"\n    Meteor.call 'setRepliedToLastEmail', sponsor._id, sponsor.referrerId, false\n","markers":{"markers":{"1":{"id":1,"range":[[84,4],[84,4]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":2879,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[85,34],[85,34]],"newRange":[[85,34],[85,35]],"oldText":"","newText":".","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[85,35],[85,35]]},"newParams":{"reversed":true,"range":[[85,34],[85,35]]},"deserializer":"MarkerPatch"},{"oldRange":[[85,34],[85,35]],"newRange":[[85,34],[85,34]],"oldText":".","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,34],[85,34]],"newRange":[[85,34],[85,35]],"oldText":"","newText":".","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,35],[85,35]],"newRange":[[85,35],[85,36]],"oldText":"","newText":"e","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,36],[85,36]],"newRange":[[85,36],[85,37]],"oldText":"","newText":"m","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,37],[85,37]],"newRange":[[85,37],[85,38]],"oldText":"","newText":"a","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,38],[85,38]],"newRange":[[85,38],[85,39]],"oldText":"","newText":"i","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,39],[85,39]],"newRange":[[85,39],[85,40]],"oldText":"","newText":"l","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[86,48],[86,48]],"newRange":[[86,48],[86,49]],"oldText":"","newText":".","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[86,49],[86,49]],"newRange":[[86,49],[86,50]],"oldText":"","newText":"_","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[86,50],[86,50]],"newRange":[[86,50],[86,51]],"oldText":"","newText":"i","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[86,51],[86,51]],"newRange":[[86,51],[86,52]],"oldText":"","newText":"d","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[87,21],[87,21]]},"newParams":{"range":[[87,20],[87,21]]},"deserializer":"MarkerPatch"},{"oldRange":[[87,20],[87,21]],"newRange":[[87,20],[87,20]],"oldText":"e","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[87,20],[87,20]]},"newParams":{"range":[[87,19],[87,20]]},"deserializer":"MarkerPatch"},{"oldRange":[[87,19],[87,20]],"newRange":[[87,19],[87,19]],"oldText":"r","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[87,55],[88,8]]},"newParams":{"tailed":false,"range":[[87,55],[87,55]]},"deserializer":"MarkerPatch"},{"oldRange":[[87,55],[88,8]],"newRange":[[87,55],[87,56]],"oldText":"\n        ","newText":" ","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"range":[[87,55],[87,55]]},"newParams":{"range":[[87,56],[87,56]]},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[87,76],[87,81]]},"newParams":{"tailed":false,"range":[[87,81],[87,81]]},"deserializer":"MarkerPatch"},{"oldRange":[[87,76],[87,81]],"newRange":[[87,76],[87,77]],"oldText":"false","newText":"o","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[87,77],[87,77]],"newRange":[[87,77],[87,78]],"oldText":"","newText":"f","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[87,78],[87,78]],"newRange":[[87,78],[87,79]],"oldText":"","newText":"f","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[87,79],[87,79]],"newRange":[[87,79],[87,80]],"oldText":"","newText":":","normalizeLineEndings":{},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[87,80],[87,80]]},"newParams":{"reversed":true,"range":[[87,79],[87,80]]},"deserializer":"MarkerPatch"},{"oldRange":[[87,79],[87,80]],"newRange":[[87,79],[87,79]],"oldText":":","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[84,35],[85,40]],"newRange":[[84,35],[84,35]],"oldText":"\n      console.log 'blast', sponsor.email","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,0],[85,0]],"newRange":[[85,0],[86,0]],"oldText":"","newText":"      console.log 'blast', sponsor.email\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[84,35],[85,40]],"newRange":[[84,35],[84,35]],"oldText":"\n      console.log 'blast', sponsor.email","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[45,0],[45,0]],"newRange":[[45,0],[48,0]],"oldText":"","newText":"    resendReferral: (sponsor) ->\n      EmailService.sendReferralInviteEmail sponsor.email,\n        Meteor.userId(), sponsor.sponsorId\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[48,0],[51,0]],"newRange":[[48,0],[48,0]],"oldText":"  resendReferral: (sponsor) ->\n    EmailService.sendReferralInviteEmail sponsor.email,\n    Meteor.userId(), sponsor.sponsorId\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[83,0],[84,0]],"newRange":[[83,0],[83,0]],"oldText":"    console.log sponsorsToSendTo\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[84,0],[84,0]],"newRange":[[84,0],[87,0]],"oldText":"","newText":"      EmailService.sendNextCampaignEmail sponsor\n      Meteor.call 'resetRepliedToLastEmail', sponsor._id,\n        sponsor.referrerId, false\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[87,0],[89,0]],"newRange":[[87,0],[87,0]],"oldText":"      EmailService.sendNextCampaignEmail sponsor._id\n      Meteor.call 'setRepliedToLastEmail', sponsor._id, sponsor.referrerId, off\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[45,0],[45,0]],"newRange":[[45,0],[48,0]],"oldText":"","newText":"  resendReferral: (sponsor) ->\n    EmailService.sendReferralInviteEmail sponsor.email,\n    Meteor.userId(), sponsor.sponsorId\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[48,0],[51,0]],"newRange":[[48,0],[48,0]],"oldText":"    resendReferral: (sponsor) ->\n      EmailService.sendReferralInviteEmail sponsor.email,\n        Meteor.userId(), sponsor.sponsorId\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[83,0],[83,0]],"newRange":[[83,0],[84,0]],"oldText":"","newText":"    console.log sponsorsToSendTo\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[85,0],[85,0]],"newRange":[[85,0],[87,0]],"oldText":"","newText":"      EmailService.sendNextCampaignEmail sponsor._id\n      Meteor.call 'setRepliedToLastEmail', sponsor._id, sponsor.referrerId, off\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[87,0],[90,0]],"newRange":[[87,0],[87,0]],"oldText":"      EmailService.sendNextCampaignEmail sponsor\n      Meteor.call 'resetRepliedToLastEmail', sponsor._id,\n        sponsor.referrerId, false\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[85,0],[85,0]],"newRange":[[85,0],[89,0]],"oldText":"","newText":"      console.log 'blast', sponsor\n      EmailService.sendNextCampaignEmail sponsor\n      Meteor.call 'resetRepliedToLastEmail', sponsor._id,\n        sponsor.referrerId, false\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[89,0],[91,0]],"newRange":[[89,0],[89,0]],"oldText":"      EmailService.sendNextCampaignEmail sponsor._id\n      Meteor.call 'setRepliedToLastEmail', sponsor._id, sponsor.referrerId, off\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/andrewhazlett/BTSync/dropoly/webapp/collections/sponsors.coffee","modifiedWhenLastPersisted":true,"digestWhenLastPersisted":"c7ad604f17175f672a9ca995376f8d1edbdce23f","deserializer":"TextBuffer"},{"text":"<template name=\"sponsors\">\n  <div class='col-xs-6'>\n    <h3>Sponsors</h3>\n    <p>When sponsors verify or reply to your emails this list will update automatically</p>\n  </div>\n  <!--<div class='col-sm-6'>\n    <button class=\"btn btn-primary pull-right sendNextAll\">Send Next Email to All</button>\n  </div>\n  -->\n  <div class='well clearfix table-responsive col-xs-12'>\n    <table class=\"table\" style='color: #449398;'>\n      <thead>\n        <tr>\n          <th>Email</th>\n          <th class=\"tableCenter\">Points</th>\n          <th class=\"tableCenter\">Confirmed</th>\n          <th class=\"tableCenter\">Replied</th>\n          <th>Send Next</th>\n        </tr>\n      </thead>\n      <tbody>\n        {{#each sponsors}}\n        <tr id=\"superRow\" class=\"{{#if this.confirmed}}confirmed{{else}}unconfirmed{{/if}}\">\n          <td id=\"email\"> {{this.email}} </td>\n          <td class=\"tableCenter\"> {{this.points}} </td>\n          <td class=\"tableCenter\">\n            {{#if this.confirmed}}\n            <span class=\"glyphicon glyphicon-ok\"></span>\n            {{else}}\n            <span class=\"glyphicon glyphicon-remove\"></span>\n            {{/if}}\n          </td>\n          <td class=\"tableCenter\">\n            {{#if this.repliedToLastEmail}}\n            <span class=\"glyphicon glyphicon-ok\"></span>\n            {{else}}\n            <span class=\"glyphicon glyphicon-remove\"></span>\n            {{/if}}\n          </td>\n          <td>\n            {{#if this.confirmed}}\n            {{#if this.repliedToLastEmail}}\n            <button id=\"sendNext\" type=\"button\" class=\"btn btn-primary btn-sm\">Send Next Email (+9)</button>\n            {{else}}\n            <button id=\"sendNext\" type=\"button\" class=\"btn btn-default btn-sm disabled\">Waiting for Response</button>\n            {{/if}}\n            {{else}}\n            <button id=\"sendNext\" type=\"button\" class=\"btn btn-warning btn-sm\">Resend Invite</button>\n            {{/if}}\n          </td>\n        </tr>\n        {{/each}}\n      </tbody>\n    </table>\n  </div>\n</template>","markers":{"markers":{"1":{"id":1,"range":[[7,8],[7,8]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":2888,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":false,"range":[[5,6],[5,6]]},"newParams":{"reversed":true,"range":[[5,5],[5,6]]},"deserializer":"MarkerPatch"},{"oldRange":[[5,5],[5,6]],"newRange":[[5,5],[5,5]],"oldText":"-","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[5,5],[5,5]]},"newParams":{"range":[[5,4],[5,5]]},"deserializer":"MarkerPatch"},{"oldRange":[[5,4],[5,5]],"newRange":[[5,4],[5,4]],"oldText":"-","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[5,4],[5,4]]},"newParams":{"range":[[5,3],[5,4]]},"deserializer":"MarkerPatch"},{"oldRange":[[5,3],[5,4]],"newRange":[[5,3],[5,3]],"oldText":"!","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[5,3],[5,3]]},"newParams":{"range":[[5,2],[5,3]]},"deserializer":"MarkerPatch"},{"oldRange":[[5,2],[5,3]],"newRange":[[5,2],[5,2]],"oldText":"<","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[8,5],[8,5]]},"newParams":{"range":[[8,4],[8,5]]},"deserializer":"MarkerPatch"},{"oldRange":[[8,4],[8,5]],"newRange":[[8,4],[8,4]],"oldText":">","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[8,4],[8,4]]},"newParams":{"range":[[8,3],[8,4]]},"deserializer":"MarkerPatch"},{"oldRange":[[8,3],[8,4]],"newRange":[[8,3],[8,3]],"oldText":"-","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[8,3],[8,3]]},"newParams":{"range":[[8,2],[8,3]]},"deserializer":"MarkerPatch"},{"oldRange":[[8,2],[8,3]],"newRange":[[8,2],[8,2]],"oldText":"-","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[8,2],[8,2]]},"newParams":{"range":[[8,0],[8,2]]},"deserializer":"MarkerPatch"},{"oldRange":[[8,0],[8,2]],"newRange":[[8,0],[8,0]],"oldText":"  ","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"range":[[8,0],[8,0]]},"newParams":{"range":[[7,8],[8,0]]},"deserializer":"MarkerPatch"},{"oldRange":[[7,8],[8,0]],"newRange":[[7,8],[7,8]],"oldText":"\n","newText":"","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":true},"newParams":{"tailed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[54,11],[54,11]],"newRange":[[54,11],[55,0]],"oldText":"","newText":"\n","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"tailed":false},"newParams":{"tailed":true},"deserializer":"MarkerPatch"},{"id":1,"oldParams":{"reversed":true},"newParams":{"reversed":false},"deserializer":"MarkerPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[43,0],[43,0]],"newRange":[[43,0],[44,0]],"oldText":"","newText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-primary btn-sm disabled\">Waiting for Response</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[44,0],[45,0]],"newRange":[[44,0],[44,0]],"oldText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-default btn-sm disabled\">Waiting for Response</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[46,0],[46,0]],"newRange":[[46,0],[47,0]],"oldText":"","newText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-primary btn-sm\">Resend Invite</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[47,0],[48,0]],"newRange":[[47,0],[47,0]],"oldText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-warning btn-sm\">Resend Invite</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[54,0],[54,0]],"newRange":[[54,0],[54,11]],"oldText":"","newText":"</template>","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[54,11],[55,0]],"newRange":[[54,11],[54,11]],"oldText":"</template>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[43,0],[43,0]],"newRange":[[43,0],[44,0]],"oldText":"","newText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-default btn-sm disabled\">Waiting for Response</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[44,0],[45,0]],"newRange":[[44,0],[44,0]],"oldText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-primary btn-sm disabled\">Waiting for Response</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[46,0],[46,0]],"newRange":[[46,0],[47,0]],"oldText":"","newText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-warning btn-sm\">Resend Invite</button>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[47,0],[48,0]],"newRange":[[47,0],[47,0]],"oldText":"            <button id=\"sendNext\" type=\"button\" class=\"btn btn-primary btn-sm\">Resend Invite</button>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[54,0],[54,0]],"newRange":[[54,0],[55,0]],"oldText":"","newText":"</template>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[55,0],[55,11]],"newRange":[[55,0],[55,0]],"oldText":"</template>","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[6,0]],"oldText":"","newText":"  <!--<div class='col-sm-6'>\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[6,0],[7,0]],"newRange":[[6,0],[6,0]],"oldText":"  <div class='col-sm-6'>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[8,0],[8,0]],"newRange":[[8,0],[9,0]],"oldText":"","newText":"  -->\n","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[55,0],[55,0]],"newRange":[[55,0],[55,11]],"oldText":"","newText":"</template>","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[55,11],[56,0]],"newRange":[[55,11],[55,11]],"oldText":"</template>\n","newText":"","normalizeLineEndings":{"normalizeLineEndings":false},"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"filePath":"/Users/andrewhazlett/BTSync/dropoly/webapp/client/views/connect/sponsors.html","modifiedWhenLastPersisted":true,"digestWhenLastPersisted":"3f44c0a50bad02bdc8b93f633d1effcc80cb4348","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"children":[{"items":[{"deserializer":"SettingsView","version":2,"activePanelName":"autocomplete-plus","uri":"atom://config"},{"id":2879,"softTabs":true,"displayBuffer":{"id":2880,"softWrap":true,"editorWidthInChars":108,"scrollTop":711,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/andrewhazlett/BTSync/dropoly/webapp/collections/sponsors.coffee","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":2888,"softTabs":true,"displayBuffer":{"id":2889,"softWrap":true,"editorWidthInChars":109,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/andrewhazlett/BTSync/dropoly/webapp/client/views/connect/sponsors.html","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/andrewhazlett/BTSync/dropoly/webapp/collections/sponsors.coffee","focused":false,"active":true,"deserializer":"Pane"},{"items":[{"id":2855,"softTabs":true,"displayBuffer":{"id":2854,"softWrap":true,"editorWidthInChars":110,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/andrewhazlett/BTSync/dropoly/webapp/client/views/connect/unsubscribe.html","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"},{"id":2863,"softTabs":true,"displayBuffer":{"id":2864,"softWrap":true,"editorWidthInChars":109,"scrollTop":160,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/andrewhazlett/BTSync/dropoly/webapp/server/email.coffee","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/andrewhazlett/BTSync/dropoly/webapp/server/email.coffee","focused":false,"active":false,"deserializer":"Pane"}],"orientation":"horizontal","deserializer":"PaneAxis"},"deserializer":"PaneContainer"},"fullScreen":true,"deserializer":"Workspace"},"packageStates":{"fuzzy-finder":{"/Users/andrewhazlett/BTSync/dropoly/webapp/collections/sponsors.coffee":1401388408177,"/Users/andrewhazlett/BTSync/dropoly/webapp/client/views/connect/sponsors.html":1401386837142,"/Users/andrewhazlett/BTSync/dropoly/webapp/client/views/connect/unsubscribe.html":1401386569595,"/Users/andrewhazlett/BTSync/dropoly/webapp/server/email.coffee":1401386571637},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":691126565},"tree-view":{"directoryExpansionStates":{"client":{"router":{},"views":{"connect":{}}},"collections":{},"tests":{}},"selectedPath":"/Users/andrewhazlett/BTSync/dropoly/webapp/tests","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":283},"find-and-replace":{"viewState":{"findHistory":["sendReferralEmail","campaign0","profile.sponsors.$.repliedToLastEmail","campaignEmail","setRepliedToLastEmail"],"replaceHistory":["campaign"],"modelState":{"useRegex":false,"inCurrentSelection":false,"caseSensitive":false}},"projectViewState":{"findHistory":["click","sendReferralEmail","pointsEarned","quiz","sendEmail","lessonDefaultPoints","Meteor.Error","PointsHub"],"replaceHistory":[],"pathsHistory":["client","collections"],"modelState":{"useRegex":false,"caseSensitive":false}},"resultsModelState":{"useRegex":false,"caseSensitive":false}}}}